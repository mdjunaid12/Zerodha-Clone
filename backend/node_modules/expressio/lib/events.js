"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

var _isString = _interopRequireDefault(require("lodash/isString"));

var _isFunction = _interopRequireDefault(require("lodash/isFunction"));

var _ndtk = _interopRequireDefault(require("ndtk"));

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

/**
 * Async Events
 *
 * @copyright Copyright (c) 2018, hugw.io
 * @author Hugo W - contact@hugw.io
 * @license MIT
 */
var _default = server => {
  const stack = {};
  /**
   * Register new events
   */

  const on = (event, fn) => {
    _ndtk.default.assert((0, _isString.default)(event) && event.length !== 0, 'Events error: event is not a string');

    _ndtk.default.assert((0, _isFunction.default)(fn), `Events error: "${event}" event has not a valid function`);

    if (!stack[event]) stack[event] = [fn];else stack[event] = [...stack[event], fn];
  };
  /**
   * Emit events
   */


  const emit = (event, ...args) => {
    _ndtk.default.assert((0, _isString.default)(event) && event.length !== 0, 'Events error: event is not a string');

    const events = stack[event] || [];
    return Promise.all(events.map(fn => fn(server, ...args)));
  }; // Expose Events Api to the server object


  server.events = {
    on,
    emit
  };
};

exports.default = _default;
//# sourceMappingURL=events.js.map